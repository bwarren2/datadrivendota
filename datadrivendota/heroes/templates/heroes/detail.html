{% extends "heroes/base.html" %}
{% load staticfiles %}

{% block title %}{{ hero.name }}{% endblock %}

{% block page_title %}{% endblock %}

{% block content %}
  <div class="hero-lore">
    <h1>{{ hero.name }}</h1>

    <div class="infobox thumbnail">
      {% if hero.mugshot %}
      <div class="aligner">
        <a class="thumbnail">
          <img class="hero" src='{{ hero.mugshot.url }}'>
        </a>
        <div class='roles'>
          {% for assignment in hero.assignment_set.all %}
            {# <p alt="{{ assignment.role.name }}" title="{{ assignment.role.name }}" class="role-magnitude-{{ assignment.magnitude }}">{{ assignment.role.name }}</p> #}
            <img src="{{ assignment.role.thumbshot.url }}" alt="{{ assignment.role.name }}" title="{{ assignment.role.name }}" class="role-magnitude-{{ assignment.magnitude }}">
          {% endfor %}
        </div>
      </div>
      {% endif %}
      <table class="table">
        <thead>
          <tr>
            <td>Stat</td>
            <td>Level 1</td>
            <td>Level 16</td>
            <td>Level 25</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              Strength: {{ dossier.strength }} + {{ dossier.strength_gain }}
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=strength&level=1">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=strength&level=16">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=strength&level=25">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
          </tr>
          <tr>
            <td>
              Agility: {{ dossier.agility }} + {{ dossier.agility_gain }}
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=agility&level=1">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=agility&level=16">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=agility&level=25">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
          </tr>
          <tr>
            <td>
              Intelligence: {{ dossier.intelligence }} + {{ dossier.intelligence_gain }}
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=intelligence&level=1">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=intelligence&level=16">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
            <td>
              <a href="{% url 'heroes:lineup' %}?heroes={{hero.name}}&stats=intelligence&level=25">
                <i class='glyphicon glyphicon-signal'  title='Click me!' style='display:inline-block'></i>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
      <div>Day/Night vision: {{ dossier.day_vision }} / {{ dossier.night_vision }}</div>
      <div>HP/Mana regen: {{ dossier.hp_regen }} / {{ dossier.mana_regen }}</div>
    </div>
    <div id='top_charts'></div>
    <blockquote class="lore">
      {{ hero.lore }}
    </blockquote>
  </div>
  <div class="hero-ability-list">
    {% for ability in abilities %}
      <a href="{% url 'heroes:ability_detail' ability_name=ability.machine_name hero_name=ability.hero.machine_name %}" class="ability thumbnail">
        <img src="{{ ability.picture.url }}" alt="{{ ability.name }}" class="ability">
        <p class='overlayer'>{{ ability.name }}</p>
      </a>
    {% endfor %}
    <div class="clearfix"></div>
  </div>
  <div class="hero-chart-list">
    <span id='chart1'></span>
    <span id='chart2'></span>
    <span id='chart3'></span>
  </div>
{% endblock content %}

{% block extra_js %}
  <script type="text/javascript">
    d3.json('{{MEDIA_URL}}{{player_json}}',function(source){
      var input_data = source;
      window.d3ening.plot(source, '#top_charts')
    });


    function show_progress_bar (identifier) {
      var progressbar = $("<div>");
      progressbar.attr('id', 'progbar_loading');
      progressbar.addClass("progress");
      progressbar.addClass("progress-striped active");

      var progressbar_inner = $("<div>");
      progressbar_inner.addClass("progress-bar");
      progressbar_inner.attr('role', "progressbar");
      progressbar_inner.attr('aria-valuenow', "100");
      progressbar_inner.attr('aria-valuemin', "0");
      progressbar_inner.attr('aria-valuemax', "100");
      progressbar_inner.css('width', '100%');

      progressbar.append(progressbar_inner);

      $(identifier).append(progressbar);
    }

    $(function() {
      show_progress_bar('#chart1');
      show_progress_bar('#chart2');
      show_progress_bar('#chart3');
      $.get(
        '{% url "heroes:hero_performance_api" %}',
        {
          hero: '{{ hero.name }}',
          x_var: 'duration',
          y_var: 'kills',
          group_var: 'skill',
        },
        function(json){
          $('chart1#progressbar').remove()
          $( "#chart1" ).html('<img id="theImg" src='+json['url']+' />');
        },
        'json'
      );

      $.get(
        '{% url "heroes:hero_performance_api" %}',
        {
          hero: '{{ hero.name }}',
          x_var: 'duration',
          y_var: 'K-D+.5*A',
          group_var: 'skill',
        },
        function(json){
          $('chart2#progressbar').remove()
          $( "#chart2" ).html('<img id="theImg" src='+json['url']+' />')
        },
        'json'
      );

      $.get(
        '{% url "heroes:hero_performance_api" %}',
        {
          hero: '{{ hero.name }}',
          x_var: 'duration',
          y_var: 'gold_total',
          group_var: 'skill',
        },
        function(json){
          $('chart3#progressbar').remove()
          $( "#chart3" ).html('<img id="theImg" src='+json['url']+' />')
        },
        'json'
      );
    });
  </script>
{% endblock extra_js  %}



