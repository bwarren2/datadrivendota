{% extends "matches/base.html" %}

{% load staticfiles player_extras %}

{% block extra_css %}{{ form.media }}{% endblock extra_css %}

{% block title %}Match #{{ match.steam_id }}{% endblock title %}

{% block page_title %}Match #{{ match.steam_id }}{% endblock page_title %}

{% block content %}
  <div class="match-data">
    {{ match.game_mode.description }} {{ match.lobby_type.description }},
    {{ match.hms_duration }} @ {{ match.hms_start_time }}
  </div>

  <div id='charts'>
  {% if abilities_json %}
    <span id='abilities'></span>
  {% endif %}
  {% if kill_dmg_json %}
    <span id='kill_dmg'></span>
  {% endif %}
  {% if xp_gold_json %}
    <span id='xp_gold'></span>
  {% endif %}
  </div>
  
  {% if dire_bans %}
    <div class="row">
      <div class="dire-pickban col-md-6">
        <h3>Dire</h3>
        <div class="row">
          <div class="col-md-3">
            <h4>Ban</h4>
            <ul class="pickban-list" id="dire-ban">
              {% for pb in dire_bans %}
                <li data-pborder="{{ pb.order }}">
                  <a href="#" class="thumbnail">
                    <img src="{{ pb.hero.thumbshot.url }}" alt="{{ pb.hero.name }}" title="{{ pb.hero.name }}">
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
          <div class="col-md-9">
            <h4>Pick</h4>
            <ul class="pickban-list" id="dire-pick">
              {% for pb in dire_picks %}
                <li data-pborder="{{ pb.order }}">
                  <a href="#" class="thumbnail">
                    <img src="{{ pb.hero.mugshot.url }}" alt="{{ pb.hero.name }}" title="{{ pb.hero.name }}">
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <div class="radiant-pickban col-md-6">
        <h3>Radiant</h3>
        <div class="row">
          <div class="col-md-3">
            <h4>Ban</h4>
            <ul class="pickban-list" id="dire-ban">
              {% for pb in radiant_bans %}
                <li data-pborder="{{ pb.order }}">
                  <a href="#" class="thumbnail">
                    <img src="{{ pb.hero.thumbshot.url }}" alt="{{ pb.hero.name }}" title="{{ pb.hero.name }}">
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
          <div class="col-md-9">
            <h4>Pick</h4>
            <ul class="pickban-list" id="dire-pick">
              {% for pb in radiant_picks %}
                <li data-pborder="{{ pb.order }}">
                  <a href="#" class="thumbnail">
                    <img src="{{ pb.hero.mugshot.url }}" alt="{{ pb.hero.name }}" title="{{ pb.hero.name }}">
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="row controls-button">
      <div class="col-sm-12 text-center">
        <button class="btn btn-default" id="pickban-reveal">Reveal pick/ban</button>
      </div>
    </div>
  {% endif %}

  <div>
    <table class="table  table-condensed" id='myTable'>
      <thead>
        <tr>
          <th>Hero</th>
          <th colspan="2">Player</th>
          <th>K</th>
          <th>D</th>
          <th>A</th>
          <th>K-D+A/2</th>
          <th>Items</th>
          <th>Level</th>
          <th>Last Hits</th>
          <th>Denies</th>
          <th>Gold/min</th>
          <th>XP/min</th>
          <th>Hero Dmg</th>
          <th>Tower Dmg</th>
          <th>Hero Heal</th>
          <th>Side</th>
        </tr>
      </thead>
      <tbody>
        {% for summary in summaries %}
          <tr{% if summary.is_win %} class="winner"{% endif %}>
            <td><img src="{{ summary.hero.thumbshot.url }}" alt="{{ summary.hero.name }}" title="{{ summary.hero.name }}" class="summary-hero-thumbshot"></td>
            <td>{% player_link summary.player %}</td>
            <td><img src="{{ summary.player.avatar }}"></td>
            <td>{{ summary.kills }}</td>
            <td>{{ summary.deaths }}</td>
            <td>{{ summary.assists }}</td>
            <td>{{ summary.kda }}</td>

            <td class="match-summary-images">
              {% if summary.item_0.thumbshot %}
                <img src="{{ summary.item_0.thumbshot.url }}">
              {% endif %}
              {% if summary.item_1.thumbshot %}
                <img src="{{ summary.item_1.thumbshot.url }}">
              {% endif %}
              {% if summary.item_2.thumbshot %}
                <img src="{{ summary.item_2.thumbshot.url }}">
              {% endif %}
              {% if summary.item_3.thumbshot %}
                <img src="{{ summary.item_3.thumbshot.url }}">
              {% endif %}
              {% if summary.item_4.thumbshot %}
                <img src="{{ summary.item_4.thumbshot.url }}">
              {% endif %}
              {% if summary.item_5.thumbshot %}
                <img src="{{ summary.item_5.thumbshot.url }}">
              {% endif %}

            </td>

            <td>{{ summary.level }}</td>
            <td>{{ summary.last_hits }}</td>
            <td>{{ summary.denies }}</td>
            <td>{{ summary.gold_per_min }}</td>
            <td>{{ summary.xp_per_min }}</td>
            <td>{{ summary.hero_damage }}</td>
            <td>{{ summary.tower_damage }}</td>
            <td>{{ summary.hero_healing }}</td>
            <td>
              {{ summary.which_side }}
              {% if summary.is_win %} (win){% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">
  $(document).ready(function () {
    $('#pickban-reveal').click(function () {
      $('#pickban-reveal').attr('disabled', 'disabled');
      $('.pickban-list li').fadeOut();
      var PICKBAN_LIMIT = 20;
      var PICKBAN_REVEAL_SECONDS = 2;
      for (var i = 0; i < PICKBAN_LIMIT; i++) {
        setTimeout(function (count) {
          $('[data-pborder=' + count + ']').fadeIn();
        }, i * PICKBAN_REVEAL_SECONDS * 1000, i);
      }
      setTimeout(function () {
        $('#pickban-reveal').removeAttr("disabled");
      }, i * PICKBAN_REVEAL_SECONDS * 1000);
    });
  });
</script>
<script type="text/javascript">
    {% if kill_dmg_json %}
      var kill_raw_data;
      d3.json('{{MEDIA_URL}}{{kill_dmg_json}}', function(source){
        raw_data=source
        window.d3ening.plot(source,'#kill_dmg')
      })
    {% endif %}
    {% if xp_gold_json %}
      var xp_raw_data;
      d3.json('{{MEDIA_URL}}{{xp_gold_json}}', function(source){
        xp_raw_data=source
        window.d3ening.plot(source,'#xp_gold')
      })
    {% endif %}
    {% if abilities_json %}
      var xp_raw_data;
      d3.json('{{MEDIA_URL}}{{abilities_json}}', function(source){
        xp_raw_data=source
        window.d3ening.plot(source,'#abilities')
      })
    {% endif %}
</script>

{% endblock extra_js %}
