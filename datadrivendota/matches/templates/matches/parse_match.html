{% extends "matches/base.html" %}

{% load staticfiles player_extras %}

{% block title %}Match #{{ match.steam_id }}{% endblock title %}

{% block page_title %}Match #{{ match.steam_id }}
<small>  {{ match.game_mode.description }} {{ match.lobby_type.description }},
    {{ match.hms_duration }} @ {{ match.hms_start_time }}</small>
    {% if match.league.leaguedossier %}
      <br>
      <small>Tournament:
      {% if match.league.leaguedossier.tournament_url %}
        <a href="{{match.league.leaguedossier.tournament_url}}">{{match.league.leaguedossier.display_name}}</a>
      {% else %}
        {{match.league.leaguedossier.display_name}}
      {% endif %}</small>
    {% endif %}
    {% endblock page_title %}

{% block content %}

  {% include "matches/_match_cards.html" %}

    <div class='container'>
        <div class='row' id='buttons'>
            <h2>Animation (times approximate):</h2>
            <div class='col-md-1'>
                <button id='stop-animation' type="button" class="btn btn-primary btn-lg btn-block animation-button">Stop</button>
            </div>
            <div class='col-md-1'>
                <button id='start-animation' type="button" class="btn btn-primary btn-lg btn-block animation-button">Start</button>
            </div>
            <div class='col-md-1'>
                <button id='back-animation' type="button" class="btn btn-primary btn-lg btn-block animation-button">
                    <span  class="info glyphicon glyphicon-backward">
                </button>
            </div>
            <div class='col-md-1'>
                <button id='forward-animation' type="button" class="btn btn-primary btn-lg btn-block animation-button">
                    <span  class="info glyphicon glyphicon-forward">
                </button>
            </div>
            <div class='col-md-2'>
                <input style='margin-top:5px' id='time-display' class='form-control' type='text' placeholder='Replay Time' readonly>
            </div>

            <div class='col-md-4 col-md-offset-1' id='related-match'>
                <a href="{%url 'matches:match_detail' match_id=match.steam_id%}"><button id='start-animation' type="button" class="btn btn-primary btn-lg btn-block">Match Summary</button></a>

            </div>
        </div>
        <div class='row' >
            <div class='col-md-4'>
                {% comment %}
                <h4>Hero Kills <span  class="info glyphicon glyphicon-info-sign" data-toggle="tooltip" title="" data-placement="right"></span></h4>
                {% endcomment %}

            </div>
            <div class='col-md-4'>
            </div>

             <div class='col-md-4'>
            </div>

        </div>
        <div class='row' id='hero-charts'>

            <div class='col-md-4'>
            </div>
            <div class='col-md-4'>
            </div>
            <div class='col-md-4'>
            </div>

        </div>
        <div class='row'>
            <div class='col-md-6 col-md-offset-3' id='note'>
                <p>Note: This is alpha tech.  There are some known issues, but the gist is here.</p>
            </div>
        </div>

    </div>{% endblock content %}

{% block extra_js %}
<script type="text/javascript">

$(function(){

    function updateTimer(d){
        $('#time-display').val(String((d-d%60)/60)+':'+String(d%60))
    }

    function healthBars(){
        console.log('In health bars.')
    }
    function setUp(heroes, timeline){
        console.log('Setting up.')
        healthBars()
    }

    // Animation Controls
    $('#stop-animation').toggle()
    $('#start-animation').click(function(){
        $('#start-animation').toggle();
        $('#stop-animation').toggle();
        $('#back-animation').toggle();
        $('#forward-animation').toggle();
    });
    $('#stop-animation').click(function(){
        $('#start-animation').toggle();
        $('#stop-animation').toggle();
        $('#back-animation').toggle();
        $('#forward-animation').toggle();
    });

    var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);


    var url = '{% static timeline %}';
    var timeline;
    var heroes;
    var chats;
    var hero_creeps = $.getJSON(url, function(result){
        timeline = result['timeline']
        heroes = result['heroes']
        chats = result['chats']
        console.log(heroes);
        setUp();
        // bindHandlers();
    });

    // Handling Handlers
    // var myhandle
    // var start = function(){
    //     update()
    //     myhandle = setTimeout(tick, duration)
    // }

    // var stop = function (){
    //     clearTimeout(myhandle)
    // }

    // $('#back-animation').click(function(){
    //     --idx;
    //     update();
    // });
    // $('#forward-animation').click(function(){
    //     ++idx;
    //     update();
    // });

})
</script>

{% endblock extra_js %}

{% block extra_css %}
    <style type="text/css">
    {% for key, value in css_color_dict.iteritems %}
        .{{key}} {
            fill: {{value}};
        }
    {% endfor %}
    {% for key, value in slot_dict.iteritems %}
        .player-slot-{{key}} {
             box-shadow: 0 0 25.5px {{value}};
        }
    {% endfor %}
    path{
        fill: none;
    }
    .animation-button{
        height:45px;
    }
    </style>
{% endblock extra_css %}

